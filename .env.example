# serverless-dns Environment Variables
# Copy this file to .env and modify as needed
# Reference: src/core/env.js

# =============================================================================
# RUNTIME ENVIRONMENT
# =============================================================================

# Environment stage (production or development)
# Workers
WORKER_ENV=development
# Deno (Note: DENO_ENV is reserved, use DENO_ENV_DOMAIN instead)
DENO_ENV_DOMAIN=development
# Fastly
FASTLY_ENV=development
# Node.js
NODE_ENV=development
# Bun
BUN_ENV=development

# Cloud platform (cloudflare, fly, deno-deploy, fastly, local)
CLOUD_PLATFORM=local

# =============================================================================
# TLS CONFIGURATION
# =============================================================================

# Path to TLS private key
TLS_KEY_PATH=test/data/tls/dns.rethinkdns.localhost.key

# Path to TLS certificate chain
TLS_CRT_PATH=test/data/tls/dns.rethinkdns.localhost.crt

# Set to true if TLS termination is offloaded to external process (e.g., Fly.io edge)
TLS_OFFLOAD=false

# Set to true to allow any SNI in TLS handshake (disables SNI validation)
TLS_ALLOW_ANY_SNI=false

# TLS Pre-Shared Key for DoH/DoT (hex 64 bytes or base64 48 bytes)
# DO NOT check-in actual values; use secrets management (e.g., flyctl secrets set)
TLS_PSK=

# =============================================================================
# LOGGING
# =============================================================================

# Log level (debug, info, warn, error)
LOG_LEVEL=debug

# Enable Cloudflare Logpush
LOGPUSH_ENABLED=false

# Use hostname as log-id if not set in request
LOGPUSH_HOSTNAME_AS_LOGID=false

# Allowed sources for logpush (comma-separated, empty = allow all)
LOGPUSH_SRC=

# =============================================================================
# CLOUDFLARE CONFIGURATION (for Workers deployment)
# =============================================================================

# Cloudflare account ID (set via secret)
CF_ACCOUNT_ID=

# Cloudflare API token with analytics/logpush permissions (set via secret)
CF_API_TOKEN=

# R2 access key for logpush bucket (set via secret)
CF_LOGPUSH_R2_ACCESS_KEY=

# R2 secret key for logpush bucket (set via secret)
CF_LOGPUSH_R2_SECRET_KEY=

# R2 path for logpush (e.g., bucket-name/ or bucket-name/dir)
CF_LOGPUSH_R2_PATH=

# =============================================================================
# DNS CONFIGURATION
# =============================================================================

# URL to blocklist files (trie, rank-dir, metadata)
CF_BLOCKLIST_URL=https://cfstore.rethinkdns.com/blocklists/

# Primary DoH upstream resolver
CF_DNS_RESOLVER_URL=https://cloudflare-dns.com/dns-query

# Secondary DoH upstream resolver
CF_DNS_RESOLVER_URL_2=https://dns.google/dns-query

# Upstream recursive RethinkDNS resolver on Fly.io (must end with /)
MAX_DNS_RESOLVER_URL=https://max.rethinkdns.com/

# =============================================================================
# TIMEOUTS AND CACHING
# =============================================================================

# Max DoH request processing timeout in ms
WORKER_TIMEOUT=10000

# Max blocklist download timeout in ms
CF_BLOCKLIST_DOWNLOAD_TIMEOUT=7500

# TTL for DNS answers in seconds (overrides upstream TTLs)
CACHE_TTL=1800

# =============================================================================
# BLOCKLIST CONFIGURATION
# =============================================================================

# Disable blocklist downloading entirely
DISABLE_BLOCKLISTS=false

# Download blocklists to disk and exit (for pre-caching)
BLOCKLIST_DOWNLOAD_ONLY=false

# Auto-renew blocklists older than N weeks (0 or negative = never)
AUTO_RENEW_BLOCKLISTS_OLDER_THAN=42

# Treat blocklists as wildcards (block *.blocked-domain.com)
BLOCK_SUBDOMAINS=true

# =============================================================================
# GEOIP
# =============================================================================

# GeoIP database URL (courtesy db-ip.com)
GEOIP_URL=https://cfstore.rethinkdns.com/geoip/2022/1667349639157/

# =============================================================================
# ACCESS CONTROL
# =============================================================================

# Access keys for authentication (comma-separated hex strings)
# Format: domain.tld|hex(hmac-sha256(key, info))
# Empty = no authentication required
ACCESS_KEYS=

# =============================================================================
# GATEWAY IPS
# =============================================================================

# Return these Gateway IPs for eligible requests
GW_IP4=
GW_IP6=

# =============================================================================
# NODE.JS SPECIFIC
# =============================================================================

# Use only DoH upstream on Node.js (UDP/TCP is default)
NODE_DOH_ONLY=false

# =============================================================================
# PROFILING (development only)
# =============================================================================

# Enable DNS resolution profiling
PROFILE_DNS_RESOLVES=false
